(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42],{7936:function(e,s,r){Promise.resolve().then(r.bind(r,5681))},5681:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return m}});var a=r(7437),t=r(2660),o=r(3247),c=r(8930),l=r(2265),n=r(7648),i=r(3145),d=r(9376);function m(){let[e,s]=(0,l.useState)([]),[r,m]=(0,l.useState)(null),u=(0,d.useRouter)();return(0,l.useEffect)(()=>{fetch("./setup.json").then(e=>e.json()).then(m).catch(console.error)},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=(await new Promise((e,s)=>{let r=indexedDB.open("ImageStorageDB",1);r.onsuccess=()=>{let a=r.result.transaction("images","readonly").objectStore("images").getAll();a.onsuccess=s=>{e((s.target.result||[]).sort((e,s)=>new Date(s.timestamp).getTime()-new Date(e.timestamp).getTime()))},a.onerror=()=>s(Error("Error retrieving images from IndexedDB"))},r.onerror=()=>s(Error("IndexedDB access failed"))})).map(e=>({id:e.id,src:e.data,alt:"Captured on ".concat(e.timestamp),caption:new Date(e.timestamp).toLocaleString()}));s(e)}catch(e){console.error("Failed to load images",e)}})()},[]),(0,a.jsxs)("div",{className:"flex min-h-screen flex-col",children:[(0,a.jsx)("header",{className:"sticky top-0 z-10 border-b bg-opacity-95 backdrop-blur ".concat(null==r?void 0:r.appBackground," ").concat(null==r?void 0:r.borderColor),children:(0,a.jsx)("div",{className:"container flex items-center",style:{paddingTop:"env(safe-area-inset-top)",height:"calc(56px + env(safe-area-inset-top))"},children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.default,{href:"/",children:(0,a.jsxs)("button",{className:"hover:opacity-80 ".concat(null==r?void 0:r.buttonPrimary),children:[(0,a.jsx)(t.Z,{className:"size-5"}),(0,a.jsx)("span",{className:"sr-only",children:"Back"})]})}),(0,a.jsx)("h1",{className:"text-lg font-semibold ".concat(null==r?void 0:r.headingColor),children:"Search History"})]})})}),(0,a.jsx)("main",{className:"flex-1",children:(0,a.jsx)("div",{className:"container py-4",children:(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3",children:e.map((e,t)=>(0,a.jsxs)("div",{className:"overflow-hidden border ".concat(null==r?void 0:r.cardBackground," ").concat(null==r?void 0:r.borderColor," rounded-lg"),children:[(0,a.jsx)("div",{className:"relative aspect-video",children:(0,a.jsx)(i.default,{src:e.src||"/placeholder.svg",alt:e.alt,fill:!0,className:"object-cover"})}),(0,a.jsx)("div",{className:"flex flex-col items-start gap-2 p-4",children:(0,a.jsxs)("div",{className:"flex w-full justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h3",{className:"line-clamp-1 font-medium text-gray-400",children:e.caption})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{className:"size-8 text-blue-400 hover:opacity-80",onClick:()=>u.push("/imageGallery?imageId=".concat(e.id)),children:[(0,a.jsx)(o.Z,{className:"size-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Search again"})]}),(0,a.jsxs)("button",{className:"size-8 text-red-500 hover:opacity-80",onClick:async()=>{try{var r;await (r=e.id,new Promise((e,s)=>{let a=indexedDB.open("ImageStorageDB",1);a.onsuccess=()=>{let t=a.result.transaction("images","readwrite");t.objectStore("images").delete(r),t.oncomplete=()=>e(),t.onerror=()=>s(t.error)},a.onerror=()=>s(a.error)})),s(s=>s.filter(s=>s.id!==e.id))}catch(e){console.error("Failed to delete image",e)}},children:[(0,a.jsx)(c.Z,{className:"size-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Delete"})]})]})]})})]},t))})})}),(0,a.jsx)("footer",{className:"mb-16 border-t px-6 py-4 pb-[env(safe-area-inset-bottom)] ".concat(null==r?void 0:r.borderColor),children:(0,a.jsxs)("div",{className:"container flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:[e.length," items in history"]}),(0,a.jsxs)("button",{className:"rounded border px-3 py-1 ".concat(null==r?void 0:r.borderColor," text-red-400 hover:bg-red-900/20"),onClick:async()=>{try{await new Promise((e,s)=>{let r=indexedDB.open("ImageStorageDB",1);r.onsuccess=()=>{let a=r.result.transaction("images","readwrite").objectStore("images").clear();a.onsuccess=()=>e(),a.onerror=()=>s(a.error)},r.onerror=()=>s(r.error)}),s([])}catch(e){console.error("Failed to clear history:",e)}},children:[(0,a.jsx)(c.Z,{className:"mr-2 size-4"}),"Clear History"]})]})})]})}}},function(e){e.O(0,[648,226,971,117,744],function(){return e(e.s=7936)}),_N_E=e.O()}]);